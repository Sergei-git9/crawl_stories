<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å CRAWL.STORIES</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

  <style>
    :root {
      --bg-primary: #020205;
      --bg-secondary: #0b0b0f;
      --bg-card: #0b0b0f;
      --accent-primary: #ffe81f;
      --accent-secondary: #6366f1;
      --text-primary: #ffffff;
      --text-secondary: #9aa0a6;
      --text-muted: #7f8c8d;
      --border-light: rgba(255, 255, 255, 0.1);
      --font-mono: "Courier New", monospace;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font-mono);
      min-height: 100vh;
    }

    /* LOGIN SCREEN */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-card {
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    .login-card h2 {
      color: var(--accent-primary);
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border-light);
      background: #05050a;
      color: #ddd;
      font-family: var(--font-mono);
      font-size: 14px;
    }

    /* BUTTONS */
    button {
      background: var(--accent-primary);
      color: var(--bg-primary);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-family: var(--font-mono);
      font-weight: bold;
      transition: opacity 0.3s;
    }

    button:hover {
      opacity: 0.9;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 12px;
    }

    .btn-secondary {
      background: transparent;
      color: var(--accent-primary);
      border: 1px solid var(--border-light);
    }

    .btn-danger {
      background: #ff4444;
      color: white;
    }

    .btn-success {
      background: #4caf50;
      color: white;
    }

    .btn-info {
      background: var(--accent-secondary);
      color: white;
    }

    /* ADMIN INTERFACE */
    .admin-interface {
      display: none;
      min-height: 100vh;
    }

    header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-light);
      background: rgba(2, 2, 5, 0.95);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .header-nav {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* MAIN CONTENT */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* STORIES GRID */
    .stories-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      margin-top: 20px;
    }

    .story-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border-light);
      transition: border-color 0.3s;
      cursor: pointer;
    }

    .story-card:hover {
      border-color: rgba(255, 232, 31, 0.3);
      transform: translateY(-2px);
    }

    .story-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
      gap: 10px;
    }

    .story-title {
      color: var(--accent-primary);
      font-size: 18px;
      margin: 0;
      line-height: 1.3;
      flex: 1;
    }

    .story-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      white-space: nowrap;
      font-weight: bold;
    }

    .badge.announcement {
      background: rgba(255, 193, 7, 0.1);
      color: #ffc107;
    }

    .badge.draft {
      background: rgba(158, 158, 158, 0.1);
      color: #9e9e9e;
    }

    .badge.working {
      background: rgba(33, 150, 243, 0.1);
      color: #2196f3;
    }

    .badge.published {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
    }

    .badge.hidden {
      background: rgba(158, 158, 158, 0.1);
      color: #9e9e9e;
      border: 1px dashed #9e9e9e;
    }

    .story-desc {
      color: var(--text-secondary);
      margin-bottom: 15px;
      font-size: 14px;
      line-height: 1.4;
    }

    .story-date {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* MODALS */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--border-light);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      color: var(--accent-primary);
      font-size: 20px;
    }

    .close-modal {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      padding: 0;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border-light);
      background: #05050a;
      color: #ddd;
      font-family: var(--font-mono);
      font-size: 14px;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }

    .checkbox-group label {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .genres-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .drop-zone {
      border: 2px dashed var(--accent-primary);
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      color: var(--text-secondary);
      margin: 10px 0;
      transition: all 0.3s;
      cursor: pointer;
    }

    .drop-zone:hover {
      background: rgba(255, 232, 31, 0.1);
    }

    .drop-zone.active {
      background: rgba(255, 232, 31, 0.1);
      border-color: var(--accent-primary);
    }

    .date-precision {
      font-size: 12px;
      color: var(--accent-primary);
      margin-top: 5px;
    }

    /* SCHEDULE */
    .schedule-list {
      margin-top: 20px;
    }

    .schedule-item {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .schedule-info {
      flex: 1;
    }

    .schedule-date {
      text-align: right;
      min-width: 200px;
    }

    .publish-date {
      color: var(--accent-primary);
      font-weight: bold;
    }

    .publish-status {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* SETTINGS */
    .settings-grid {
      display: grid;
      gap: 20px;
      margin-top: 20px;
    }

    .settings-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border-light);
    }

    .theme-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .theme-option {
      background: var(--bg-secondary);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s;
    }

    .theme-option:hover {
      border-color: var(--accent-secondary);
    }

    .theme-option.active {
      border-color: var(--accent-primary);
    }

    /* EMPTY STATES */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 20px;
    }

    /* LOADING */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .header-nav {
        justify-content: center;
      }

      .stories-grid {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .schedule-date {
        text-align: left;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div id="loginScreen" class="login-screen">
    <div class="login-card">
      <h2>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
      <form id="loginForm">
        <div class="form-group">
          <label>–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
          <input type="password" id="adminPassword" required />
        </div>
        <button type="submit">–í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É</button>
      </form>
    </div>
  </div>

  <!-- ADMIN INTERFACE -->
  <div id="adminInterface" class="admin-interface">
    <header>
      <div class="header-content">
        <h1>‚öôÔ∏è –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ CRAWL.STORIES</h1>
        <div class="header-nav">
          <button id="btnCreateStory" class="btn btn-success">‚ûï –°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
          <button id="btnStories" class="btn btn-secondary">üìö –ò—Å—Ç–æ—Ä–∏–∏</button>
          <button id="btnSchedule" class="btn btn-secondary">üìÖ –ì—Ä–∞—Ñ–∏–∫</button>
          <button id="btnImport" class="btn btn-info">üì• –ò–º–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤–æ–π –∏—Å—Ç–æ—Ä–∏–∏</button>
          <button id="btnSettings" class="btn btn-secondary">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
          <button id="btnLogout" class="btn btn-danger">üö™ –í—ã–π—Ç–∏</button>
        </div>
      </div>
    </header>

    <div class="main-content">
      <!-- STORIES VIEW -->
      <div id="storiesView">
        <h2>üìö –í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏</h2>
        <div id="storiesList" class="stories-grid">
          <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–π...</div>
        </div>
      </div>

      <!-- SCHEDULE VIEW -->
      <div id="scheduleView" style="display: none;">
        <h2>üìÖ –ì—Ä–∞—Ñ–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h2>
        <div id="scheduleList" class="schedule-list">
          <div class="empty-state">
            <div class="icon">üìÖ</div>
            <p>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π</p>
          </div>
        </div>
      </div>

      <!-- IMPORT VIEW -->
      <div id="importView" style="display: none;">
        <h2>üì• –ò–º–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤–æ–π –∏—Å—Ç–æ—Ä–∏–∏</h2>
        <div class="empty-state">
          <div class="icon">üì•</div>
          <p>–§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏</p>
        </div>
      </div>

      <!-- SETTINGS VIEW -->
      <div id="settingsView" style="display: none;">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞</h2>
        <div class="settings-grid">
          <div class="settings-card">
            <h3>üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
            <div class="theme-options">
              <div class="theme-option active" data-theme="default">
                <div style="font-size: 24px;">üåô</div>
                <div>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</div>
              </div>
              <div class="theme-option" data-theme="light">
                <div style="font-size: 24px;">‚òÄÔ∏è</div>
                <div>–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</div>
              </div>
              <div class="theme-option" data-theme="newyear">
                <div style="font-size: 24px;">‚ùÑÔ∏è</div>
                <div>–ù–æ–≤—ã–π –≥–æ–¥</div>
              </div>
              <div class="theme-option" data-theme="halloween">
                <div style="font-size: 24px;">üéÉ</div>
                <div>–•—ç–ª–ª–æ—É–∏–Ω</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: CREATE STORY -->
  <div id="createStoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">‚ûï –°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</h3>
        <button class="close-modal">&times;</button>
      </div>
      
      <form id="createStoryForm">
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ *</label>
          <input type="text" id="storyTitle" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏">
        </div>

        <div class="form-group">
          <label>–û–±–ª–æ–∂–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏</label>
          <div class="drop-zone" id="coverDropZone">
            <div>üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</div>
            <div style="font-size: 12px; margin-top: 8px;">–∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
            <input type="file" id="coverFile" accept="image/*" style="display: none;">
          </div>
          <div id="coverPreview" style="display: none; margin-top: 10px;">
            <img id="coverPreviewImg" style="max-width: 200px; border-radius: 8px;">
          </div>
        </div>

        <div class="form-group">
          <label>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea id="storyDescription" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ —Å—é–∂–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏..."></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–∏–∑–æ–¥–æ–≤</label>
            <input type="number" id="plannedEpisodes" min="0" placeholder="–ù–µ —É–∫–∞–∑–∞–Ω–æ">
          </div>
          <div class="form-group">
            <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
            <input type="text" id="publishDate" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì, –ú–ú.–ì–ì–ì–ì –∏–ª–∏ –ì–ì–ì–ì">
            <div class="date-precision" id="datePrecision"></div>
          </div>
        </div>

        <div class="form-group">
          <label>–ñ–∞–Ω—Ä—ã</label>
          <div class="genres-container">
            <div class="checkbox-group">
              <input type="checkbox" id="genreFantasy" value="fantasy">
              <label for="genreFantasy">üßô –§—ç–Ω—Ç–µ–∑–∏</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="genreScifi" value="sci-fi">
              <label for="genreScifi">üöÄ –ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="genreHorror" value="horror">
              <label for="genreHorror">üëª –•–æ—Ä—Ä–æ—Ä</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="genreAdventure" value="adventure">
              <label for="genreAdventure">üó∫Ô∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="genreMystery" value="mystery">
              <label for="genreMystery">üïµÔ∏è –ú–∏—Å—Ç–∏–∫–∞</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="genreRomance" value="romance">
              <label for="genreRomance">üíñ –†–æ–º–∞–Ω—Ç–∏–∫–∞</label>
            </div>
          </div>
        </div>

        <div class="form-actions" style="display: flex; gap: 10px; margin-top: 20px;">
          <button type="button" class="btn btn-secondary" id="btnCancelStory">‚ùå –û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-success">‚úÖ –°–æ–∑–¥–∞—Ç—å –∞–Ω–æ–Ω—Å</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    class AdminPanel {
      constructor() {
        this.stories = [];
        this.currentView = 'stories';
        this.adminPassword = "1111";
        
        // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        this.firebaseConfig = {
          apiKey: "AIzaSyANC4K0-xI-9SvrpoiOp4v-N2XLvCQCALg",
          authDomain: "crawl-stories.firebaseapp.com",
          projectId: "crawl-stories",
          storageBucket: "crawl-stories.firebasestorage.app",
          messagingSenderId: "886479757650",
          appId: "1:886479757650:web:194ad1dd2d02c959bdda8b",
          measurementId: "G-SGC2HF0455",
        };

        this.init();
      }

      async init() {
        try {
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
          if (typeof firebase !== 'undefined') {
            firebase.initializeApp(this.firebaseConfig);
            this.db = firebase.firestore();
            console.log("üî• Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
          } else {
            console.warn("Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∂–∏–º –¥–µ–º–æ");
          }

          this.setupEventListeners();
          this.showLoginScreen();
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", error);
        }
      }

      showLoginScreen() {
        document.getElementById("loginScreen").style.display = "flex";
        document.getElementById("adminInterface").style.display = "none";
      }

      showAdminInterface() {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("adminInterface").style.display = "block";
        this.loadStories();
      }

      setupEventListeners() {
        // –õ–æ–≥–∏–Ω
        document.getElementById("loginForm").addEventListener("submit", (e) => {
          e.preventDefault();
          this.handleLogin();
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        document.getElementById("btnCreateStory").addEventListener("click", () => {
          this.showCreateStoryModal();
        });

        document.getElementById("btnStories").addEventListener("click", () => {
          this.showView('stories');
        });

        document.getElementById("btnSchedule").addEventListener("click", () => {
          this.showView('schedule');
        });

        document.getElementById("btnImport").addEventListener("click", () => {
          this.showView('import');
        });

        document.getElementById("btnSettings").addEventListener("click", () => {
          this.showView('settings');
        });

        document.getElementById("btnLogout").addEventListener("click", () => {
          this.showLoginScreen();
        });

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
        document.getElementById("createStoryForm").addEventListener("submit", (e) => {
          e.preventDefault();
          this.createStory();
        });

        document.getElementById("btnCancelStory").addEventListener("click", () => {
          this.hideModal('createStoryModal');
        });

        document.querySelector("#createStoryModal .close-modal").addEventListener("click", () => {
          this.hideModal('createStoryModal');
        });

        // Drag & drop –¥–ª—è –æ–±–ª–æ–∂–∫–∏
        const dropZone = document.getElementById('coverDropZone');
        const fileInput = document.getElementById('coverFile');

        dropZone.addEventListener('click', () => {
          fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
          this.handleCoverSelect(e.target.files[0]);
        });

        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('active');
        });

        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('active');
        });

        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('active');
          const file = e.dataTransfer.files[0];
          if (file && file.type.startsWith('image/')) {
            this.handleCoverSelect(file);
          }
        });

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã
        document.getElementById('publishDate').addEventListener('input', (e) => {
          this.updateDatePrecision(e.target.value);
        });

        // –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
        document.querySelectorAll('.theme-option').forEach(option => {
          option.addEventListener('click', (e) => {
            this.selectTheme(e.currentTarget.dataset.theme);
          });
        });
      }

      handleLogin() {
        const password = document.getElementById("adminPassword").value;
        if (password === this.adminPassword) {
          this.showAdminInterface();
        } else {
          alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
        }
      }

      showView(viewName) {
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤—å—é
        document.getElementById('storiesView').style.display = 'none';
        document.getElementById('scheduleView').style.display = 'none';
        document.getElementById('importView').style.display = 'none';
        document.getElementById('settingsView').style.display = 'none';

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤—å—é
        document.getElementById(viewName + 'View').style.display = 'block';
        this.currentView = viewName;

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (viewName === 'stories') {
          this.loadStories();
        } else if (viewName === 'schedule') {
          this.loadSchedule();
        }
      }

      showCreateStoryModal() {
        document.getElementById('createStoryModal').style.display = 'flex';
        document.getElementById('createStoryForm').reset();
        document.getElementById('coverPreview').style.display = 'none';
        document.getElementById('datePrecision').textContent = '';
      }

      hideModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
      }

      handleCoverSelect(file) {
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const preview = document.getElementById('coverPreview');
          const img = document.getElementById('coverPreviewImg');
          img.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }

      updateDatePrecision(dateString) {
        const precisionEl = document.getElementById('datePrecision');
        if (!dateString.trim()) {
          precisionEl.textContent = '';
          return;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã
        if (dateString.match(/^\d{2}\.\d{2}\.\d{4}$/)) {
          precisionEl.textContent = '‚úÖ —Ç–æ—á–Ω–∞—è –¥–∞—Ç–∞';
        } else if (dateString.match(/^\d{2}\.\d{4}$/)) {
          precisionEl.textContent = 'üìÖ –º–µ—Å—è—Ü –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω';
        } else if (dateString.match(/^\d{4}$/)) {
          precisionEl.textContent = 'üìÖ –≥–æ–¥ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω';
        } else {
          precisionEl.textContent = '‚ùå –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì, –ú–ú.–ì–ì–ì–ì –∏–ª–∏ –ì–ì–ì–ì)';
        }
      }

      async createStory() {
        const title = document.getElementById('storyTitle').value.trim();
        const description = document.getElementById('storyDescription').value.trim();
        const plannedEpisodes = document.getElementById('plannedEpisodes').value;
        const publishDate = document.getElementById('publishDate').value.trim();

        if (!title) {
          alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏');
          return;
        }

        // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã
        const genres = [];
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
          genres.push(checkbox.value);
        });

        try {
          const storyData = {
            title: title,
            description: description,
            coverUrl: document.getElementById('coverPreviewImg').src || '',
            plannedEpisodes: plannedEpisodes ? parseInt(plannedEpisodes) : null,
            publishDate: publishDate || null,
            genres: genres,
            status: 'announcement',
            episodesCount: 0,
            createdAt: new Date(),
            updatedAt: new Date()
          };

          if (this.db) {
            const docRef = await this.db.collection('stories').add(storyData);
            console.log('‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞:', docRef.id);
          } else {
            // –î–µ–º–æ-—Ä–µ–∂–∏–º
            storyData.id = 'demo-' + Date.now();
            this.stories.push(storyData);
          }

          this.hideModal('createStoryModal');
          this.loadStories();
          alert('‚úÖ –ê–Ω–æ–Ω—Å –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω!');
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:', error);
          alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏');
        }
      }

      async loadStories() {
        try {
          if (this.db) {
            const snapshot = await this.db.collection('stories').orderBy('createdAt', 'desc').get();
            this.stories = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
          }

          this.renderStories();
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–π:', error);
          // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
          this.stories = [
            {
              id: 'demo-1',
              title: '–ü—Ä–∏–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏',
              description: '–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è',
              status: 'announcement',
              publishDate: '12.2024',
              episodesCount: 0,
              createdAt: new Date()
            }
          ];
          this.renderStories();
        }
      }

      renderStories() {
        const container = document.getElementById('storiesList');
        
        if (this.stories.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="icon">üìö</div>
              <p>–ò—Å—Ç–æ—Ä–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
              <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∏—Å—Ç–æ—Ä–∏—é</p>
            </div>
          `;
          return;
        }

        container.innerHTML = this.stories.map(story => `
          <div class="story-card" onclick="adminPanel.openStoryConfig('${story.id}')">
            <div class="story-header">
              <h3 class="story-title">${story.title}</h3>
              <div class="story-meta">
                <span class="badge ${story.status}">${this.getStatusText(story.status)}</span>
                ${story.episodesCount > 0 ? `<span class="badge">üìä ${story.episodesCount} —ç–ø.</span>` : ''}
              </div>
            </div>
            <p class="story-desc">${story.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
            ${story.publishDate ? `<div class="story-date">üìÖ ${this.formatPublishDate(story.publishDate)}</div>` : ''}
          </div>
        `).join('');
      }

      openStoryConfig(storyId) {
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏
        window.open(`admin_config.html?story=${storyId}`, '_blank');
      }

      async loadSchedule() {
        const container = document.getElementById('scheduleList');
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏–∏ —Å –¥–∞—Ç–∞–º–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
        const scheduledStories = this.stories.filter(story => story.publishDate);
        
        if (scheduledStories.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="icon">üìÖ</div>
              <p>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π</p>
            </div>
          `;
          return;
        }

        container.innerHTML = scheduledStories.map(story => `
          <div class="schedule-item">
            <div class="schedule-info">
              <h4>${story.title}</h4>
              <p>${story.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
            </div>
            <div class="schedule-date">
              <div class="publish-date">${this.formatPublishDate(story.publishDate)}</div>
              <div class="publish-status">${this.getStatusText(story.status)}</div>
            </div>
          </div>
        `).join('');
      }

      selectTheme(theme) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–µ–º
        document.querySelectorAll('.theme-option').forEach(option => {
          option.classList.remove('active');
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–µ
        document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É (–∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã –∫–æ –≤—Å–µ–º—É —Å–∞–π—Ç—É)
        this.applyTheme(theme);
        alert(`‚úÖ –¢–µ–º–∞ "${theme}" –ø—Ä–∏–º–µ–Ω–µ–Ω–∞`);
      }

      applyTheme(theme) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã –∫–æ –≤—Å–µ–º—É —Å–∞–π—Ç—É
        console.log('–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Ç–µ–º–∞:', theme);
        // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ç.–¥.
      }

      getStatusText(status) {
        const statuses = {
          'announcement': '–ê–Ω–æ–Ω—Å',
          'draft': '–ß–µ—Ä–Ω–æ–≤–∏–∫',
          'working': '–í —Ä–∞–±–æ—Ç–µ',
          'published': '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ',
          'hidden': '–°–∫—Ä—ã—Ç–æ'
        };
        return statuses[status] || status;
      }

      formatPublishDate(dateString) {
        if (dateString.match(/^\d{2}\.\d{2}\.\d{4}$/)) {
          return `–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: ${dateString}`;
        } else if (dateString.match(/^\d{2}\.\d{4}$/)) {
          const [month, year] = dateString.split('.');
          const monthNames = ['—è–Ω–≤–∞—Ä—å', '—Ñ–µ–≤—Ä–∞–ª—å', '–º–∞—Ä—Ç', '–∞–ø—Ä–µ–ª—å', '–º–∞–π', '–∏—é–Ω—å', '–∏—é–ª—å', '–∞–≤–≥—É—Å—Ç', '—Å–µ–Ω—Ç—è–±—Ä—å', '–æ–∫—Ç—è–±—Ä—å', '–Ω–æ—è–±—Ä—å', '–¥–µ–∫–∞–±—Ä—å'];
          return `–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ ${monthNames[parseInt(month) - 1]} ${year}`;
        } else if (dateString.match(/^\d{4}$/)) {
          return `–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ ${dateString}`;
        }
        return dateString;
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
    document.addEventListener('DOMContentLoaded', () => {
      window.adminPanel = new AdminPanel();
    });
  </script>
</body>
</html>
